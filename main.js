/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => ABSPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  host: "",
  apiKey: "",
  abDir: "",
  abEnable: false,
  abLib: "",
  abSortBy: "",
  abTemplate: "",
  ebDir: "",
  ebEnable: false,
  ebLib: "",
  ebSortBy: "",
  ebTemplate: "",
  podDir: "",
  podEnable: false,
  podLib: "",
  podSortBy: "",
  podTemplate: ""
};
var ABSPlugin = class extends import_obsidian.Plugin {
  async loadSettings() {
    this.settings = Object.assign(
      {},
      DEFAULT_SETTINGS,
      await this.loadData()
    );
  }
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new ABSPluginSettingTab(this.app, this));
    const ribbonIconEl = this.addRibbonIcon("audio-file", "ABS", () => {
      this.fetchAndCreateNotes();
    });
    this.addCommand({
      id: "fetch-books",
      name: "Fetch books and create notes",
      callback: async () => {
        await this.fetchAndCreateNotes();
      }
    });
  }
  async fetchAndCreateNotes() {
    if (!this.settings.host || !this.settings.apiKey) {
      new import_obsidian.Notice("Please configure API settings in the Audiobookshelf Importer settings.");
      return;
    }
    if (this.settings.abEnable === false && this.settings.ebEnable === false && this.settings.podEnable === false) {
      new import_obsidian.Notice("Please enable a library to import in the Audiobookshelf Importer settings.");
      return;
    }
    if (this.settings.abEnable === true) {
      this.abImport();
    }
    if (this.settings.ebEnable === true) {
      this.ebImport();
    }
    if (this.settings.podEnable === true) {
      this.podImport();
    }
  }
  async abImport() {
    const apiUrl = `https://${this.settings.host}/api/libraries/${this.settings.abLib}/items?sort=media.metadata.title`;
    try {
      const response = await (0, import_obsidian.request)({
        url: apiUrl,
        method: "GET",
        headers: {
          Authorization: `Bearer ${this.settings.apiKey}`
        }
      });
      if (!response) {
        throw new Error(`Failed to fetch books: ${response}`);
      }
      const data = JSON.parse(response);
      const books = (data.results || []).map((book) => {
        var _a;
        return {
          id: book.id,
          relPath: book.relPath,
          metadata: ((_a = book.media) == null ? void 0 : _a.metadata) || {}
        };
      });
      const folder = this.app.vault.getAbstractFileByPath(this.settings.abDir);
      if (!folder) {
        await this.app.vault.createFolder(this.settings.abDir);
      }
      const abJsonData = {};
      for (const book of books) {
        var metadata = book.metadata;
        abJsonData.metadata = metadata;
        abJsonData.authorName = metadata.authorName;
        abJsonData.authorNameLF = metadata.authorNameLF;
        abJsonData.coverURL = `https://${this.settings.host}/audiobookshelf/api/items/${book.id}/cover`;
        abJsonData.description = metadata.description;
        abJsonData.jsonData = JSON.stringify(book, null, 2);
        abJsonData.narrator = metadata.narrator;
        abJsonData.publishedDate = metadata.publishedDate;
        abJsonData.publishedYear = metadata.publishedYear;
        abJsonData.publisher = metadata.publisher;
        abJsonData.title = metadata.title;
        const sanitizedTitle = metadata.title.replace(/[\/:*?"<>|]/g, "");
        var sortArtist = abJsonData.authorNameLF;
        if (this.settings.abSortBy == "authorNameLF") {
          sortArtist = abJsonData.authorNameLF;
        } else if (this.settings.abSortBy == "authorName") {
          sortArtist = abJsonData.authorName;
        }
        var filePath = `${this.settings.abDir}/${sortArtist}/${sanitizedTitle}.md`;
        const regex = /\b\d+(\.\d+)?,/;
        if (book.metadata.seriesName != "") {
          var origName = book.metadata.seriesName;
          if (regex.test(origName)) {
            const parts = origName.split(/(?<=\b\d+(\.\d+)?),\s*/);
            origName = parts[0];
          }
          const seriesTitle = origName.replace(/\s+#\d+(\.\d+)?$/, "").trim();
          const numberMatch = origName.match(/\s+#(\d+(\.\d+)?)$/);
          const number = numberMatch ? numberMatch[1] : null;
          filePath = `${this.settings.abDir}/${sortArtist}/${seriesTitle}/${number} | ${sanitizedTitle}.md`;
        }
        if (!this.app.vault.getAbstractFileByPath(filePath)) {
          await this.ensureFolderExists(filePath);
          await this.app.vault.create(filePath, this.getBookTemplate(abJsonData, this.settings.abTemplate));
        } else {
        }
      }
      new import_obsidian.Notice("Audiobooks fetched and notes created successfully!");
    } catch (error) {
      console.error("Error fetching Audiobooks:", error, " from ", apiUrl);
      new import_obsidian.Notice("Failed to fetch Audiobooks. Check the console for details.");
    }
  }
  async ebImport() {
    const apiUrl = `https://${this.settings.host}/api/libraries/${this.settings.ebLib}/items?sort=media.metadata.title`;
    try {
      const ebResponse = await (0, import_obsidian.request)({
        url: apiUrl,
        method: "GET",
        headers: {
          Authorization: `Bearer ${this.settings.apiKey}`
        }
      });
      if (!ebResponse) {
        throw new Error(`Failed to fetch books: ${ebResponse}`);
      }
      const data = JSON.parse(ebResponse);
      const ebBooks = (data.results || []).map((eBook) => {
        var _a;
        return {
          id: eBook.id,
          relPath: eBook.relPath,
          metadata: ((_a = eBook.media) == null ? void 0 : _a.metadata) || {}
        };
      });
      const folder = this.app.vault.getAbstractFileByPath(this.settings.ebDir);
      if (!folder) {
        await this.app.vault.createFolder(this.settings.ebDir);
      }
      const ebJsonData = {};
      for (const eBook of ebBooks) {
        var metadata = eBook.metadata;
        ebJsonData.metadata = metadata;
        ebJsonData.authorName = metadata.authorName;
        ebJsonData.authorNameLF = metadata.authorNameLF;
        ebJsonData.coverURL = `https://${this.settings.host}/audiobookshelf/api/items/${eBook.id}/cover`;
        ebJsonData.description = metadata.description;
        ebJsonData.jsonData = JSON.stringify(eBook, null, 2);
        ebJsonData.narrator = metadata.narrator;
        ebJsonData.publishedDate = metadata.publishedDate;
        ebJsonData.publishedYear = metadata.publishedYear;
        ebJsonData.publisher = metadata.publisher;
        ebJsonData.title = metadata.title;
        const sanitizedTitle = metadata.title.replace(/[\/:*?"<>|]/g, "");
        var ebSortArtist = ebJsonData.authorNameLF;
        if (this.settings.ebSortBy == "authorNameLF") {
          ebSortArtist = ebJsonData.authorNameLF;
        } else if (this.settings.ebSortBy == "authorName") {
          ebSortArtist = ebJsonData.authorName;
        }
        var filePath = `${this.settings.ebDir}/${ebSortArtist}/${sanitizedTitle}.md`;
        const regex = /\b\d+(\.\d+)?,/;
        if (eBook.metadata.seriesName != "") {
          var origName = eBook.metadata.seriesName;
          if (regex.test(origName)) {
            const parts = origName.split(/(?<=\b\d+(\.\d+)?),\s*/);
            origName = parts[0];
          }
          const seriesTitle = origName.replace(/\s+#\d+(\.\d+)?$/, "").trim();
          const numberMatch = origName.match(/\s+#(\d+(\.\d+)?)$/);
          const number = numberMatch ? numberMatch[1] : null;
          filePath = `${this.settings.ebDir}/${ebSortArtist}/${seriesTitle}/${number} | ${sanitizedTitle}.md`;
        }
        if (!this.app.vault.getAbstractFileByPath(filePath)) {
          await this.ensureFolderExists(filePath);
          await this.app.vault.create(filePath, this.getBookTemplate(ebJsonData, this.settings.ebTemplate));
        } else {
        }
      }
      new import_obsidian.Notice("eBooks fetched and notes created successfully!");
    } catch (error) {
      console.error("Error fetching eBooks:", error, " from ", apiUrl);
      new import_obsidian.Notice("Failed to fetch eBooks. Check the console for details.");
    }
  }
  async podImport() {
    const apiUrl = `https://${this.settings.host}/api/libraries/${this.settings.podLib}/items?sort=media.metadata.title`;
    try {
      const podResponse = await (0, import_obsidian.request)({
        url: apiUrl,
        method: "GET",
        headers: {
          Authorization: `Bearer ${this.settings.apiKey}`
        }
      });
      if (!podResponse) {
        throw new Error(`Failed to fetch books: ${podResponse}`);
      }
      const data = JSON.parse(podResponse);
      const podcasts = (data.results || []).map((podcast) => {
        var _a;
        return {
          id: podcast.id,
          relPath: podcast.relPath,
          metadata: ((_a = podcast.media) == null ? void 0 : _a.metadata) || {}
        };
      });
      const folder = this.app.vault.getAbstractFileByPath(this.settings.podDir);
      if (!folder) {
        await this.app.vault.createFolder(this.settings.podDir);
      }
      var epFilePath = "";
      const podJsonData = {};
      for (const podcast of podcasts) {
        var metadata = podcast.metadata;
        podJsonData.metadata = metadata;
        podJsonData.author = metadata.author;
        podJsonData.coverURL = metadata.imageUrl;
        podJsonData.description = metadata.description;
        podJsonData.jsonData = JSON.stringify(podcast, null, 2);
        podJsonData.narrator = metadata.narrator;
        podJsonData.publishedDate = metadata.publishedDate;
        podJsonData.publishedYear = metadata.publishedYear;
        podJsonData.publisher = metadata.publisher;
        podJsonData.title = metadata.title;
        const sanitizedTitle = metadata.title.replace(/[\/:*?"<>|]/g, "");
        var epApi = `https://${this.settings.host}/api/items/${podcast.id}?sort=publishedDate`;
        try {
          const epResponse = await (0, import_obsidian.request)({
            url: epApi,
            method: "GET",
            headers: {
              Authorization: `Bearer ${this.settings.apiKey}`
            }
          });
          if (!epResponse) {
            throw new Error(`Failed to fetch episodes: ${epResponse}`);
          }
          const epData = JSON.parse(epResponse);
          const episodes = (epData.media.episodes || []).map((episode) => ({
            oldEpisodeId: episode.oldEpisodeId,
            index: episode.index,
            season: episode.season,
            episode: episode.episode,
            episodeType: episode.episodeType,
            title: episode.title,
            subtitle: episode.subtitle,
            description: episode.description,
            pubDate: episode.pubDate,
            audioFile: episode.audioFile
          }));
          for (const episode of episodes) {
            podJsonData.metadata = JSON.stringify(episode.audioFile, null, 2);
            podJsonData.description = episode.description;
            podJsonData.jsonData = JSON.stringify(episode.audioFile, null, 2);
            podJsonData.publishedDate = episode.pubDate;
            podJsonData.publishedYear = episode.audioFile.metaTags.tagGenre;
            podJsonData.title = episode.title;
            const epSanitizedTitle = episode.title.replace(/[\/:*?"<>|]/g, "");
            epFilePath = `${this.settings.podDir}/${sanitizedTitle}/${epSanitizedTitle}.md`;
            if (!this.app.vault.getAbstractFileByPath(epFilePath)) {
              await this.ensureFolderExists(epFilePath);
              await this.app.vault.create(epFilePath, this.getBookTemplate(podJsonData, this.settings.podTemplate));
            } else {
            }
          }
        } catch (error) {
          console.error("Error fetching Episodes:", error, " from ", apiUrl);
          new import_obsidian.Notice("Failed to fetch Episodes. Check the console for details.");
        }
      }
      new import_obsidian.Notice("Podcasts fetched and notes created successfully!");
    } catch (error) {
      console.error("Error fetching Podcasts:", error, " from ", apiUrl);
      new import_obsidian.Notice("Failed to fetch Podcasts. Check the console for details.");
    }
  }
  async ensureFolderExists(filePath) {
    const folderPath = filePath.substring(0, filePath.lastIndexOf("/"));
    if (!folderPath) return;
    const folder = this.app.vault.getAbstractFileByPath(folderPath);
    if (!folder) {
      await this.app.vault.createFolder(folderPath);
      console.log(`Created folder: ${folderPath}`);
    }
  }
  getBookTemplate(jsonData, template) {
    return template.replace(/{{(.*?)}}/g, (_, key) => {
      return jsonData[key.trim()] || "";
    });
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
function addTextSetting(container, label, description, placeholder, settingKey) {
  const settingContainer = container.createDiv();
  settingContainer.createEl("label", { text: label, cls: "ab-setting-item-name" });
  new import_obsidian.Setting(settingContainer).setDesc(description).addText((text) => {
    text.setPlaceholder(placeholder).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
    });
    text.inputEl.style.width = "100%";
  });
}
function addDropdownSetting(container, label, settingKey, options) {
  const settingContainer = container.createDiv();
  settingContainer.createEl("label", { text: label, cls: "ab-setting-item-name" });
  new import_obsidian.Setting(settingContainer).addDropdown((dropdown) => {
    dropdown.addOptions(options).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
      console.log("value", value);
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
    });
    dropdown.selectEl.style.width = "100%";
  });
}
function addToggleSetting(container, label, description, settingKey, toggleCallback) {
  const settingContainer = container.createDiv();
  new import_obsidian.Setting(settingContainer).setName(label).setDesc(description).addToggle((toggle) => {
    toggle.setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
      this.plugin.settings[settingKey] = value;
      await this.plugin.saveSettings();
      toggleCallback(value);
    });
  });
}
function addTextAreaSetting(container, label, placeholder, settingKey) {
  const settingContainer = container.createDiv();
  settingContainer.createEl("label", { text: label, cls: "ab-setting-item-name" });
  new import_obsidian.Setting(settingContainer).addTextArea((textArea) => {
    textArea.setPlaceholder(placeholder).setValue(this.plugin.settings[settingKey]).onChange(async (value) => {
      this.plugin.settings[settingKey] = value.trim();
      await this.plugin.saveSettings();
    });
    textArea.inputEl.style.height = "150px";
    textArea.inputEl.style.width = "100%";
  });
}
var ABSPluginSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Audiobookshelf Importer Settings" });
    addTextSetting.call(this, containerEl, "ABS Host", 'Enter the base URL (without "https://")', "example.abs.org", "host");
    addTextSetting.call(this, containerEl, "API Key", "Enter your API Key", "<apiKey>", "apiKey");
    addToggleSetting.call(this, containerEl, "Audiobooks", "Toggle to enable + show settings.", "abEnable", (value) => {
      abFieldsContainer.style.display = value ? "block" : "none";
    });
    const abWrapper = containerEl.createDiv({ cls: "stacked-inputs" });
    const abFieldsContainer = abWrapper.createDiv({ cls: "fields-container" });
    addTextSetting.call(this, abFieldsContainer, "Local Directory:", "", "ABS/Audiobooks", "abDir");
    addTextSetting.call(this, abFieldsContainer, "Library ID:", "", "ads76yfsd-sd767-p9aa-34dsd-989s8dasd", "abLib");
    addDropdownSetting.call(this, abFieldsContainer, "Page Sort:", "abSortBy", {
      ["authorName"]: "Author Name | FN, LN (Asc)",
      ["authorNameLF"]: "Author Name | LN, FN (Asc)"
    });
    addTextAreaSetting.call(this, abFieldsContainer, "Page Template:", "<!--!>", "abTemplate");
    abWrapper.appendChild(abFieldsContainer);
    abFieldsContainer.style.display = this.plugin.settings.abEnable ? "block" : "none";
    addToggleSetting.call(this, containerEl, "Ebooks", "Toggle to enable + show settings.", "ebEnable", (value) => {
      ebFieldsContainer.style.display = value ? "block" : "none";
    });
    const ebWrapper = containerEl.createDiv({ cls: "stacked-inputs" });
    const ebFieldsContainer = ebWrapper.createDiv({ cls: "fields-container" });
    addTextSetting.call(this, ebFieldsContainer, "Local Directory:", "", "ABS/Ebooks", "ebDir");
    addTextSetting.call(this, ebFieldsContainer, "Library ID:", "", "ads76yfsd-sd767-p9aa-34dsd-989s8dasd", "ebLib");
    addDropdownSetting.call(this, ebFieldsContainer, "Page Sort:", "ebSortBy", {
      ["authorName"]: "Author Name | FN, LN (Asc)",
      ["authorNameLF"]: "Author Name | LN, FN (Asc)"
    });
    addTextAreaSetting.call(this, ebFieldsContainer, "Page Template:", "<!--!>", "ebTemplate");
    ebWrapper.appendChild(ebFieldsContainer);
    ebFieldsContainer.style.display = this.plugin.settings.ebEnable ? "block" : "none";
    addToggleSetting.call(this, containerEl, "Podcasts", "Toggle to enable + show settings.", "podEnable", (value) => {
      podFieldsContainer.style.display = value ? "block" : "none";
    });
    const podWrapper = containerEl.createDiv({ cls: "stacked-inputs" });
    const podFieldsContainer = podWrapper.createDiv({ cls: "fields-container" });
    addTextSetting.call(this, podFieldsContainer, "Local Directory:", "", "ABS/Podcasts", "podDir");
    addTextSetting.call(this, podFieldsContainer, "Library ID:", "", "ads76yfsd-sd767-p9aa-34dsd-989s8dasd", "podLib");
    addDropdownSetting.call(this, podFieldsContainer, "Page Sort:", "podSortBy", {
      ["authorName"]: "Author Name | FN, LN (Asc)",
      ["authorNameLF"]: "Author Name | LN, FN (Asc)"
    });
    addTextAreaSetting.call(this, podFieldsContainer, "Page Template:", "<!--!>", "podTemplate");
    podWrapper.appendChild(podFieldsContainer);
    podFieldsContainer.style.display = this.plugin.settings.podEnable ? "block" : "none";
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgIHJlcXVlc3QsIE5vdGljZSwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIEFCU1BsdWdpblNldHRpbmdzIHtcbiAgaG9zdDogc3RyaW5nO1xuICBhcGlLZXk6IHN0cmluZztcbiAgXG4gIGFiRGlyOiBzdHJpbmc7XG4gIGFiRW5hYmxlOiBib29sZWFuO1xuICBhYkxpYjogc3RyaW5nO1xuICBhYlNvcnRCeTogc3RyaW5nO1xuICBhYlRlbXBsYXRlOiBzdHJpbmc7XG5cbiAgZWJEaXI6IHN0cmluZztcbiAgZWJFbmFibGU6IGJvb2xlYW47XG4gIGViTGliOiBzdHJpbmc7XG4gIGViU29ydEJ5OiBzdHJpbmc7XG4gIGViVGVtcGxhdGU6IHN0cmluZztcblxuICBwb2REaXI6IHN0cmluZztcbiAgcG9kRW5hYmxlOiBib29sZWFuO1xuICBwb2RMaWI6IHN0cmluZztcbiAgcG9kU29ydEJ5OiBzdHJpbmc7XG4gIHBvZFRlbXBsYXRlOiBzdHJpbmc7XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEFCU1BsdWdpblNldHRpbmdzID0ge1xuICBob3N0OiBcIlwiLFxuICBhcGlLZXk6IFwiXCIsXG5cbiAgYWJEaXI6IFwiXCIsXG4gIGFiRW5hYmxlOiBmYWxzZSxcbiAgYWJMaWI6IFwiXCIsXG4gIGFiU29ydEJ5OiBcIlwiLFxuICBhYlRlbXBsYXRlOiBcIlwiLFxuXG4gIGViRGlyOiBcIlwiLFxuICBlYkVuYWJsZTogZmFsc2UsXG4gIGViTGliOiBcIlwiLFxuICBlYlNvcnRCeTogXCJcIixcbiAgZWJUZW1wbGF0ZTogXCJcIixcbiAgXG4gIHBvZERpcjogXCJcIixcbiAgcG9kRW5hYmxlOiBmYWxzZSxcbiAgcG9kTGliOiBcIlwiLFxuICBwb2RTb3J0Qnk6IFwiXCIsXG4gIHBvZFRlbXBsYXRlOiBcIlwiLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQUJTUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEFCU1BsdWdpblNldHRpbmdzO1xuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbihcbiAgICAgIHt9LCBcbiAgICAgIERFRkFVTFRfU0VUVElOR1MsIFxuICAgICAgYXdhaXQgdGhpcy5sb2FkRGF0YSgpXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBBQlNQbHVnaW5TZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICBjb25zdCByaWJib25JY29uRWwgPSB0aGlzLmFkZFJpYmJvbkljb24oXCJhdWRpby1maWxlXCIsIFwiQUJTXCIsICgpID0+IHtcbiAgICAgIC8vIG5ldyBOb3RpY2UoXCJGZXRjaGluZyBhdWRpb2Jvb2tzLi4uXCIpO1xuICAgICAgdGhpcy5mZXRjaEFuZENyZWF0ZU5vdGVzKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgaWQ6IFwiZmV0Y2gtYm9va3NcIixcbiAgICAgIG5hbWU6IFwiRmV0Y2ggYm9va3MgYW5kIGNyZWF0ZSBub3Rlc1wiLFxuICAgICAgY2FsbGJhY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5mZXRjaEFuZENyZWF0ZU5vdGVzKCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZmV0Y2hBbmRDcmVhdGVOb3RlcygpIHtcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MuaG9zdCB8fCAhdGhpcy5zZXR0aW5ncy5hcGlLZXkpIHtcbiAgICAgIG5ldyBOb3RpY2UoXCJQbGVhc2UgY29uZmlndXJlIEFQSSBzZXR0aW5ncyBpbiB0aGUgQXVkaW9ib29rc2hlbGYgSW1wb3J0ZXIgc2V0dGluZ3MuXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoKHRoaXMuc2V0dGluZ3MuYWJFbmFibGUgPT09IGZhbHNlKSAmJiAodGhpcy5zZXR0aW5ncy5lYkVuYWJsZSA9PT0gZmFsc2UpICYmICh0aGlzLnNldHRpbmdzLnBvZEVuYWJsZSA9PT0gZmFsc2UpICkge1xuICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBlbmFibGUgYSBsaWJyYXJ5IHRvIGltcG9ydCBpbiB0aGUgQXVkaW9ib29rc2hlbGYgSW1wb3J0ZXIgc2V0dGluZ3MuXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNldHRpbmdzLmFiRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICB0aGlzLmFiSW1wb3J0KClcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZXR0aW5ncy5lYkVuYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5lYkltcG9ydCgpXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2V0dGluZ3MucG9kRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnBvZEltcG9ydCgpXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYWJJbXBvcnQoKSB7XG4gICAgY29uc3QgYXBpVXJsID0gYGh0dHBzOi8vJHt0aGlzLnNldHRpbmdzLmhvc3R9L2FwaS9saWJyYXJpZXMvJHt0aGlzLnNldHRpbmdzLmFiTGlifS9pdGVtcz9zb3J0PW1lZGlhLm1ldGFkYXRhLnRpdGxlYDtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3Qoe1xuICAgICAgICB1cmw6IGFwaVVybCxcbiAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuc2V0dGluZ3MuYXBpS2V5fWAsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgXG5cbiAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggYm9va3M6ICR7cmVzcG9uc2V9YCk7XG4gICAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgXG4gICAgY29uc3QgYm9va3MgPSAoZGF0YS5yZXN1bHRzIHx8IFtdKVxuICAgICAgLm1hcCgoYm9vazogYW55KSA9PiAoe1xuICAgICAgICBpZDogYm9vay5pZCxcbiAgICAgICAgcmVsUGF0aDogYm9vay5yZWxQYXRoLFxuICAgICAgICBtZXRhZGF0YTogYm9vay5tZWRpYT8ubWV0YWRhdGEgfHwge30sIFxuICAgICAgfSkpO1xuXG4gICAgY29uc3QgZm9sZGVyID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHRoaXMuc2V0dGluZ3MuYWJEaXIpO1xuICAgIGlmICghZm9sZGVyKSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIodGhpcy5zZXR0aW5ncy5hYkRpcik7XG4gICAgfVxuXG4gICAgY29uc3QgYWJKc29uRGF0YSA6IGFueSA9IHt9O1xuICAgIGZvciAoY29uc3QgYm9vayBvZiBib29rcykge1xuICAgICAgdmFyIG1ldGFkYXRhID0gYm9vay5tZXRhZGF0YTtcbiAgICAgIGFiSnNvbkRhdGEubWV0YWRhdGEgPSBtZXRhZGF0YTtcbiAgICAgIGFiSnNvbkRhdGEuYXV0aG9yTmFtZSA9IG1ldGFkYXRhLmF1dGhvck5hbWU7XG4gICAgICBhYkpzb25EYXRhLmF1dGhvck5hbWVMRiA9IG1ldGFkYXRhLmF1dGhvck5hbWVMRjtcbiAgICAgIGFiSnNvbkRhdGEuY292ZXJVUkwgPSBgaHR0cHM6Ly8ke3RoaXMuc2V0dGluZ3MuaG9zdH0vYXVkaW9ib29rc2hlbGYvYXBpL2l0ZW1zLyR7Ym9vay5pZH0vY292ZXJgO1xuICAgICAgYWJKc29uRGF0YS5kZXNjcmlwdGlvbiA9IG1ldGFkYXRhLmRlc2NyaXB0aW9uO1xuICAgICAgYWJKc29uRGF0YS5qc29uRGF0YSA9IEpTT04uc3RyaW5naWZ5KGJvb2ssIG51bGwsIDIpO1xuICAgICAgYWJKc29uRGF0YS5uYXJyYXRvciA9IG1ldGFkYXRhLm5hcnJhdG9yO1xuICAgICAgYWJKc29uRGF0YS5wdWJsaXNoZWREYXRlID0gbWV0YWRhdGEucHVibGlzaGVkRGF0ZTtcbiAgICAgIGFiSnNvbkRhdGEucHVibGlzaGVkWWVhciA9IG1ldGFkYXRhLnB1Ymxpc2hlZFllYXI7XG4gICAgICBhYkpzb25EYXRhLnB1Ymxpc2hlciA9IG1ldGFkYXRhLnB1Ymxpc2hlcjtcbiAgICAgIGFiSnNvbkRhdGEudGl0bGUgPSBtZXRhZGF0YS50aXRsZTtcblxuICAgICAgY29uc3Qgc2FuaXRpemVkVGl0bGUgPSBtZXRhZGF0YS50aXRsZS5yZXBsYWNlKC9bXFwvOio/XCI8PnxdL2csIFwiXCIpO1xuXG4gICAgICB2YXIgc29ydEFydGlzdCA9IGFiSnNvbkRhdGEuYXV0aG9yTmFtZUxGXG4gICAgICBpZiAodGhpcy5zZXR0aW5ncy5hYlNvcnRCeSA9PSBcImF1dGhvck5hbWVMRlwiKSB7XG4gICAgICAgIHNvcnRBcnRpc3QgPSBhYkpzb25EYXRhLmF1dGhvck5hbWVMRlxuICAgICAgfWVsc2UgaWYgKHRoaXMuc2V0dGluZ3MuYWJTb3J0QnkgPT0gXCJhdXRob3JOYW1lXCIpIHtcbiAgICAgICAgc29ydEFydGlzdCA9IGFiSnNvbkRhdGEuYXV0aG9yTmFtZVxuICAgICAgfVxuXG4gICAgICB2YXIgZmlsZVBhdGggPSBgJHt0aGlzLnNldHRpbmdzLmFiRGlyfS8ke3NvcnRBcnRpc3R9LyR7c2FuaXRpemVkVGl0bGV9Lm1kYDtcblxuICAgICAgY29uc3QgcmVnZXggPSAvXFxiXFxkKyhcXC5cXGQrKT8sLztcblxuICAgICAgaWYgKGJvb2subWV0YWRhdGEuc2VyaWVzTmFtZSAhPSBcIlwiKSB7XG4gICAgICAgIHZhciBvcmlnTmFtZSA9IGJvb2subWV0YWRhdGEuc2VyaWVzTmFtZVxuICAgICAgICBpZiAocmVnZXgudGVzdChvcmlnTmFtZSkpIHtcbiAgICAgICAgICBjb25zdCBwYXJ0cyA9IG9yaWdOYW1lLnNwbGl0KC8oPzw9XFxiXFxkKyhcXC5cXGQrKT8pLFxccyovKTtcbiAgICAgICAgICBvcmlnTmFtZSA9IHBhcnRzWzBdXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VyaWVzVGl0bGUgPSBvcmlnTmFtZS5yZXBsYWNlKC9cXHMrI1xcZCsoXFwuXFxkKyk/JC8sIFwiXCIpLnRyaW0oKTtcbiAgICAgICAgY29uc3QgbnVtYmVyTWF0Y2ggPSBvcmlnTmFtZS5tYXRjaCgvXFxzKyMoXFxkKyhcXC5cXGQrKT8pJC8pO1xuICAgICAgICBjb25zdCBudW1iZXIgPSBudW1iZXJNYXRjaCA/IG51bWJlck1hdGNoWzFdIDogbnVsbDtcbiAgICAgICAgZmlsZVBhdGggPSBgJHt0aGlzLnNldHRpbmdzLmFiRGlyfS8ke3NvcnRBcnRpc3R9LyR7c2VyaWVzVGl0bGV9LyR7bnVtYmVyfSB8ICR7c2FuaXRpemVkVGl0bGV9Lm1kYDtcbiAgICAgIH1cblxuICAgICAgLy8gY29uc29sZS5sb2coZmlsZVBhdGgpXG4gICAgICBpZiAoIXRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVGb2xkZXJFeGlzdHMoZmlsZVBhdGgpO1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIHRoaXMuZ2V0Qm9va1RlbXBsYXRlKGFiSnNvbkRhdGEsIHRoaXMuc2V0dGluZ3MuYWJUZW1wbGF0ZSkpXG4gICAgICAgIC8vIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoYm9vaywgbnVsbCwgMikpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhgQ3JlYXRlZDogJHtmaWxlUGF0aH1gKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGBTa2lwcGVkOiAke2ZpbGVQYXRofSAoQWxyZWFkeSBleGlzdHMpYCk7XG4gICAgICB9XG4gICAgfVxuICAgICAgbmV3IE5vdGljZShcIkF1ZGlvYm9va3MgZmV0Y2hlZCBhbmQgbm90ZXMgY3JlYXRlZCBzdWNjZXNzZnVsbHkhXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgQXVkaW9ib29rczpcIiwgZXJyb3IsIFwiIGZyb20gXCIsIGFwaVVybCk7XG4gICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIGZldGNoIEF1ZGlvYm9va3MuIENoZWNrIHRoZSBjb25zb2xlIGZvciBkZXRhaWxzLlwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBlYkltcG9ydCgpIHtcbiAgICBjb25zdCBhcGlVcmwgPSBgaHR0cHM6Ly8ke3RoaXMuc2V0dGluZ3MuaG9zdH0vYXBpL2xpYnJhcmllcy8ke3RoaXMuc2V0dGluZ3MuZWJMaWJ9L2l0ZW1zP3NvcnQ9bWVkaWEubWV0YWRhdGEudGl0bGVgO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGViUmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHtcbiAgICAgICAgdXJsOiBhcGlVcmwsXG4gICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLnNldHRpbmdzLmFwaUtleX1gLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gIFxuXG4gICAgICBpZiAoIWViUmVzcG9uc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggYm9va3M6ICR7ZWJSZXNwb25zZX1gKTtcbiAgICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGViUmVzcG9uc2UpO1xuICAgIFxuICAgIGNvbnN0IGViQm9va3MgPSAoZGF0YS5yZXN1bHRzIHx8IFtdKVxuICAgICAgLm1hcCgoZUJvb2s6IGFueSkgPT4gKHtcbiAgICAgICAgaWQ6IGVCb29rLmlkLFxuICAgICAgICByZWxQYXRoOiBlQm9vay5yZWxQYXRoLFxuICAgICAgICBtZXRhZGF0YTogZUJvb2subWVkaWE/Lm1ldGFkYXRhIHx8IHt9LCBcbiAgICAgIH0pKTtcblxuICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCh0aGlzLnNldHRpbmdzLmViRGlyKTtcbiAgICBpZiAoIWZvbGRlcikge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKHRoaXMuc2V0dGluZ3MuZWJEaXIpO1xuICAgIH1cblxuICAgIGNvbnN0IGViSnNvbkRhdGEgOiBhbnkgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGVCb29rIG9mIGViQm9va3MpIHtcbiAgICAgIHZhciBtZXRhZGF0YSA9IGVCb29rLm1ldGFkYXRhO1xuICAgICAgZWJKc29uRGF0YS5tZXRhZGF0YSA9IG1ldGFkYXRhO1xuICAgICAgZWJKc29uRGF0YS5hdXRob3JOYW1lID0gbWV0YWRhdGEuYXV0aG9yTmFtZTtcbiAgICAgIGViSnNvbkRhdGEuYXV0aG9yTmFtZUxGID0gbWV0YWRhdGEuYXV0aG9yTmFtZUxGO1xuICAgICAgZWJKc29uRGF0YS5jb3ZlclVSTCA9IGBodHRwczovLyR7dGhpcy5zZXR0aW5ncy5ob3N0fS9hdWRpb2Jvb2tzaGVsZi9hcGkvaXRlbXMvJHtlQm9vay5pZH0vY292ZXJgO1xuICAgICAgZWJKc29uRGF0YS5kZXNjcmlwdGlvbiA9IG1ldGFkYXRhLmRlc2NyaXB0aW9uO1xuICAgICAgZWJKc29uRGF0YS5qc29uRGF0YSA9IEpTT04uc3RyaW5naWZ5KGVCb29rLCBudWxsLCAyKTtcbiAgICAgIGViSnNvbkRhdGEubmFycmF0b3IgPSBtZXRhZGF0YS5uYXJyYXRvcjtcbiAgICAgIGViSnNvbkRhdGEucHVibGlzaGVkRGF0ZSA9IG1ldGFkYXRhLnB1Ymxpc2hlZERhdGU7XG4gICAgICBlYkpzb25EYXRhLnB1Ymxpc2hlZFllYXIgPSBtZXRhZGF0YS5wdWJsaXNoZWRZZWFyO1xuICAgICAgZWJKc29uRGF0YS5wdWJsaXNoZXIgPSBtZXRhZGF0YS5wdWJsaXNoZXI7XG4gICAgICBlYkpzb25EYXRhLnRpdGxlID0gbWV0YWRhdGEudGl0bGU7XG5cbiAgICAgIGNvbnN0IHNhbml0aXplZFRpdGxlID0gbWV0YWRhdGEudGl0bGUucmVwbGFjZSgvW1xcLzoqP1wiPD58XS9nLCBcIlwiKTtcblxuICAgICAgdmFyIGViU29ydEFydGlzdCA9IGViSnNvbkRhdGEuYXV0aG9yTmFtZUxGXG4gICAgICBpZiAodGhpcy5zZXR0aW5ncy5lYlNvcnRCeSA9PSBcImF1dGhvck5hbWVMRlwiKSB7XG4gICAgICAgIGViU29ydEFydGlzdCA9IGViSnNvbkRhdGEuYXV0aG9yTmFtZUxGXG4gICAgICB9ZWxzZSBpZiAodGhpcy5zZXR0aW5ncy5lYlNvcnRCeSA9PSBcImF1dGhvck5hbWVcIikge1xuICAgICAgICBlYlNvcnRBcnRpc3QgPSBlYkpzb25EYXRhLmF1dGhvck5hbWVcbiAgICAgIH1cblxuICAgICAgdmFyIGZpbGVQYXRoID0gYCR7dGhpcy5zZXR0aW5ncy5lYkRpcn0vJHtlYlNvcnRBcnRpc3R9LyR7c2FuaXRpemVkVGl0bGV9Lm1kYDtcblxuICAgICAgY29uc3QgcmVnZXggPSAvXFxiXFxkKyhcXC5cXGQrKT8sLztcblxuICAgICAgaWYgKGVCb29rLm1ldGFkYXRhLnNlcmllc05hbWUgIT0gXCJcIikge1xuICAgICAgICB2YXIgb3JpZ05hbWUgPSBlQm9vay5tZXRhZGF0YS5zZXJpZXNOYW1lXG4gICAgICAgIGlmIChyZWdleC50ZXN0KG9yaWdOYW1lKSkge1xuICAgICAgICAgIGNvbnN0IHBhcnRzID0gb3JpZ05hbWUuc3BsaXQoLyg/PD1cXGJcXGQrKFxcLlxcZCspPyksXFxzKi8pO1xuICAgICAgICAgIG9yaWdOYW1lID0gcGFydHNbMF1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZXJpZXNUaXRsZSA9IG9yaWdOYW1lLnJlcGxhY2UoL1xccysjXFxkKyhcXC5cXGQrKT8kLywgXCJcIikudHJpbSgpO1xuICAgICAgICBjb25zdCBudW1iZXJNYXRjaCA9IG9yaWdOYW1lLm1hdGNoKC9cXHMrIyhcXGQrKFxcLlxcZCspPykkLyk7XG4gICAgICAgIGNvbnN0IG51bWJlciA9IG51bWJlck1hdGNoID8gbnVtYmVyTWF0Y2hbMV0gOiBudWxsO1xuICAgICAgICBmaWxlUGF0aCA9IGAke3RoaXMuc2V0dGluZ3MuZWJEaXJ9LyR7ZWJTb3J0QXJ0aXN0fS8ke3Nlcmllc1RpdGxlfS8ke251bWJlcn0gfCAke3Nhbml0aXplZFRpdGxlfS5tZGA7XG4gICAgICB9XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKGZpbGVQYXRoKVxuICAgICAgaWYgKCF0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRm9sZGVyRXhpc3RzKGZpbGVQYXRoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCB0aGlzLmdldEJvb2tUZW1wbGF0ZShlYkpzb25EYXRhLCB0aGlzLnNldHRpbmdzLmViVGVtcGxhdGUpKVxuICAgICAgICAvLyBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KGJvb2ssIG51bGwsIDIpKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYENyZWF0ZWQ6ICR7ZmlsZVBhdGh9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhgU2tpcHBlZDogJHtmaWxlUGF0aH0gKEFscmVhZHkgZXhpc3RzKWApO1xuICAgICAgfVxuICAgIH1cbiAgICAgIG5ldyBOb3RpY2UoXCJlQm9va3MgZmV0Y2hlZCBhbmQgbm90ZXMgY3JlYXRlZCBzdWNjZXNzZnVsbHkhXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgZUJvb2tzOlwiLCBlcnJvciwgXCIgZnJvbSBcIiwgYXBpVXJsKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gZmV0Y2ggZUJvb2tzLiBDaGVjayB0aGUgY29uc29sZSBmb3IgZGV0YWlscy5cIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcG9kSW1wb3J0KCkge1xuICAgIGNvbnN0IGFwaVVybCA9IGBodHRwczovLyR7dGhpcy5zZXR0aW5ncy5ob3N0fS9hcGkvbGlicmFyaWVzLyR7dGhpcy5zZXR0aW5ncy5wb2RMaWJ9L2l0ZW1zP3NvcnQ9bWVkaWEubWV0YWRhdGEudGl0bGVgO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBvZFJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7XG4gICAgICAgIHVybDogYXBpVXJsLFxuICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5zZXR0aW5ncy5hcGlLZXl9YCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgaWYgKCFwb2RSZXNwb25zZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBib29rczogJHtwb2RSZXNwb25zZX1gKTtcbiAgICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHBvZFJlc3BvbnNlKTtcbiAgICBcbiAgICBjb25zdCBwb2RjYXN0cyA9IChkYXRhLnJlc3VsdHMgfHwgW10pXG4gICAgICAubWFwKChwb2RjYXN0OiBhbnkpID0+ICh7XG4gICAgICAgIGlkOiBwb2RjYXN0LmlkLFxuICAgICAgICByZWxQYXRoOiBwb2RjYXN0LnJlbFBhdGgsXG4gICAgICAgIG1ldGFkYXRhOiBwb2RjYXN0Lm1lZGlhPy5tZXRhZGF0YSB8fCB7fSwgXG4gICAgICB9KSk7XG5cbiAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgodGhpcy5zZXR0aW5ncy5wb2REaXIpO1xuICAgIGlmICghZm9sZGVyKSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIodGhpcy5zZXR0aW5ncy5wb2REaXIpO1xuICAgIH1cbiAgICB2YXIgZXBGaWxlUGF0aCA9IFwiXCI7XG4gICAgY29uc3QgcG9kSnNvbkRhdGEgOiBhbnkgPSB7fTtcbiAgICBmb3IgKGNvbnN0IHBvZGNhc3Qgb2YgcG9kY2FzdHMpIHtcbiAgICAgIHZhciBtZXRhZGF0YSA9IHBvZGNhc3QubWV0YWRhdGE7XG4gICAgICBwb2RKc29uRGF0YS5tZXRhZGF0YSA9IG1ldGFkYXRhO1xuICAgICAgcG9kSnNvbkRhdGEuYXV0aG9yID0gbWV0YWRhdGEuYXV0aG9yO1xuICAgICAgcG9kSnNvbkRhdGEuY292ZXJVUkwgPSBtZXRhZGF0YS5pbWFnZVVybDtcbiAgICAgIHBvZEpzb25EYXRhLmRlc2NyaXB0aW9uID0gbWV0YWRhdGEuZGVzY3JpcHRpb247XG4gICAgICBwb2RKc29uRGF0YS5qc29uRGF0YSA9IEpTT04uc3RyaW5naWZ5KHBvZGNhc3QsIG51bGwsIDIpO1xuICAgICAgcG9kSnNvbkRhdGEubmFycmF0b3IgPSBtZXRhZGF0YS5uYXJyYXRvcjtcbiAgICAgIHBvZEpzb25EYXRhLnB1Ymxpc2hlZERhdGUgPSBtZXRhZGF0YS5wdWJsaXNoZWREYXRlO1xuICAgICAgcG9kSnNvbkRhdGEucHVibGlzaGVkWWVhciA9IG1ldGFkYXRhLnB1Ymxpc2hlZFllYXI7XG4gICAgICBwb2RKc29uRGF0YS5wdWJsaXNoZXIgPSBtZXRhZGF0YS5wdWJsaXNoZXI7XG4gICAgICBwb2RKc29uRGF0YS50aXRsZSA9IG1ldGFkYXRhLnRpdGxlO1xuXG4gICAgICBjb25zdCBzYW5pdGl6ZWRUaXRsZSA9IG1ldGFkYXRhLnRpdGxlLnJlcGxhY2UoL1tcXC86Kj9cIjw+fF0vZywgXCJcIik7XG5cbiAgICAgIHZhciBlcEFwaSA9IGBodHRwczovLyR7dGhpcy5zZXR0aW5ncy5ob3N0fS9hcGkvaXRlbXMvJHtwb2RjYXN0LmlkfT9zb3J0PXB1Ymxpc2hlZERhdGVgO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZXBSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3Qoe1xuICAgICAgICAgIHVybDogZXBBcGksXG4gICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLnNldHRpbmdzLmFwaUtleX1gLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICBcbiAgICAgICAgaWYgKCFlcFJlc3BvbnNlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggZXBpc29kZXM6ICR7ZXBSZXNwb25zZX1gKTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgY29uc3QgZXBEYXRhID0gSlNPTi5wYXJzZShlcFJlc3BvbnNlKTtcbiAgXG4gICAgICAgIGNvbnN0IGVwaXNvZGVzID0gKGVwRGF0YS5tZWRpYS5lcGlzb2RlcyB8fCBbXSlcbiAgICAgICAgICAubWFwKChlcGlzb2RlOiBhbnkpID0+ICh7XG4gICAgICAgICAgICBvbGRFcGlzb2RlSWQ6IGVwaXNvZGUub2xkRXBpc29kZUlkLFxuICAgICAgICAgICAgaW5kZXg6IGVwaXNvZGUuaW5kZXgsXG4gICAgICAgICAgICBzZWFzb246IGVwaXNvZGUuc2Vhc29uLFxuICAgICAgICAgICAgZXBpc29kZTogZXBpc29kZS5lcGlzb2RlLFxuICAgICAgICAgICAgZXBpc29kZVR5cGU6IGVwaXNvZGUuZXBpc29kZVR5cGUsXG4gICAgICAgICAgICB0aXRsZTogZXBpc29kZS50aXRsZSxcbiAgICAgICAgICAgIHN1YnRpdGxlOiBlcGlzb2RlLnN1YnRpdGxlLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGVwaXNvZGUuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBwdWJEYXRlOiBlcGlzb2RlLnB1YkRhdGUsXG4gICAgICAgICAgICBhdWRpb0ZpbGU6IGVwaXNvZGUuYXVkaW9GaWxlXG4gICAgICAgICAgfSkpO1xuICAgICAgICBcbiAgICAgICAgZm9yIChjb25zdCBlcGlzb2RlIG9mIGVwaXNvZGVzKSB7XG4gICAgICAgICAgcG9kSnNvbkRhdGEubWV0YWRhdGEgPSBKU09OLnN0cmluZ2lmeShlcGlzb2RlLmF1ZGlvRmlsZSwgbnVsbCwgMik7XG4gICAgICAgICAgcG9kSnNvbkRhdGEuZGVzY3JpcHRpb24gPSBlcGlzb2RlLmRlc2NyaXB0aW9uO1xuICAgICAgICAgIHBvZEpzb25EYXRhLmpzb25EYXRhID0gSlNPTi5zdHJpbmdpZnkoZXBpc29kZS5hdWRpb0ZpbGUsIG51bGwsIDIpO1xuICAgICAgICAgIHBvZEpzb25EYXRhLnB1Ymxpc2hlZERhdGUgPSBlcGlzb2RlLnB1YkRhdGU7XG4gICAgICAgICAgcG9kSnNvbkRhdGEucHVibGlzaGVkWWVhciA9IGVwaXNvZGUuYXVkaW9GaWxlLm1ldGFUYWdzLnRhZ0dlbnJlO1xuICAgICAgICAgIHBvZEpzb25EYXRhLnRpdGxlID0gZXBpc29kZS50aXRsZTtcblxuICAgICAgICAgIGNvbnN0IGVwU2FuaXRpemVkVGl0bGUgPSBlcGlzb2RlLnRpdGxlLnJlcGxhY2UoL1tcXC86Kj9cIjw+fF0vZywgXCJcIik7XG4gICAgICAgICAgZXBGaWxlUGF0aCA9IGAke3RoaXMuc2V0dGluZ3MucG9kRGlyfS8ke3Nhbml0aXplZFRpdGxlfS8ke2VwU2FuaXRpemVkVGl0bGV9Lm1kYDtcbiAgICAgICAgICBpZiAoIXRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChlcEZpbGVQYXRoKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVGb2xkZXJFeGlzdHMoZXBGaWxlUGF0aCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZXBGaWxlUGF0aCwgdGhpcy5nZXRCb29rVGVtcGxhdGUocG9kSnNvbkRhdGEsIHRoaXMuc2V0dGluZ3MucG9kVGVtcGxhdGUpKVxuICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShib29rLCBudWxsLCAyKSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgQ3JlYXRlZDogJHtmaWxlUGF0aH1gKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYFNraXBwZWQ6ICR7ZmlsZVBhdGh9IChBbHJlYWR5IGV4aXN0cylgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgRXBpc29kZXM6XCIsIGVycm9yLCBcIiBmcm9tIFwiLCBhcGlVcmwpO1xuICAgICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIGZldGNoIEVwaXNvZGVzLiBDaGVjayB0aGUgY29uc29sZSBmb3IgZGV0YWlscy5cIik7XG4gICAgICB9XG4gICAgfVxuICAgICAgbmV3IE5vdGljZShcIlBvZGNhc3RzIGZldGNoZWQgYW5kIG5vdGVzIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IVwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIFBvZGNhc3RzOlwiLCBlcnJvciwgXCIgZnJvbSBcIiwgYXBpVXJsKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJGYWlsZWQgdG8gZmV0Y2ggUG9kY2FzdHMuIENoZWNrIHRoZSBjb25zb2xlIGZvciBkZXRhaWxzLlwiKTtcbiAgICB9XG4gIH1cbiAgXG4gIGFzeW5jIGVuc3VyZUZvbGRlckV4aXN0cyhmaWxlUGF0aDogc3RyaW5nKSB7XG4gICAgY29uc3QgZm9sZGVyUGF0aCA9IGZpbGVQYXRoLnN1YnN0cmluZygwLCBmaWxlUGF0aC5sYXN0SW5kZXhPZihcIi9cIikpO1xuICBcbiAgICBpZiAoIWZvbGRlclBhdGgpIHJldHVybjtcbiAgXG4gICAgY29uc3QgZm9sZGVyID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZvbGRlclBhdGgpO1xuICAgIGlmICghZm9sZGVyKSB7XG4gICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGVGb2xkZXIoZm9sZGVyUGF0aCk7XG4gICAgICBjb25zb2xlLmxvZyhgQ3JlYXRlZCBmb2xkZXI6ICR7Zm9sZGVyUGF0aH1gKTtcbiAgICB9XG4gIH1cblxuICBnZXRCb29rVGVtcGxhdGUoanNvbkRhdGE6IHsgW3g6IHN0cmluZ106IGFueTsgfSwgdGVtcGxhdGU6IHN0cmluZykge1xuICAgIHJldHVybiB0ZW1wbGF0ZVxuICAgICAgLnJlcGxhY2UoL3t7KC4qPyl9fS9nLCAoXywga2V5KSA9PiB7XG4gICAgICAgIHJldHVybiBqc29uRGF0YVtrZXkudHJpbSgpXSB8fCBcIlwiO1xuICAgICAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFkZFRleHRTZXR0aW5nKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGxhYmVsOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIHBsYWNlaG9sZGVyOiBzdHJpbmcsIHNldHRpbmdLZXk6IHN0cmluZykge1xuICBjb25zdCBzZXR0aW5nQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdigpO1xuICBzZXR0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBsYWJlbCwgY2xzOiBcImFiLXNldHRpbmctaXRlbS1uYW1lXCIgfSk7XG4gIFxuICBuZXcgU2V0dGluZyhzZXR0aW5nQ29udGFpbmVyKVxuICAgIC8vIC5zZXROYW1lKGxhYmVsKVxuICAgIC5zZXREZXNjKGRlc2NyaXB0aW9uKVxuICAgIC5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcihwbGFjZWhvbGRlcilcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldKVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Nbc2V0dGluZ0tleV0gPSB2YWx1ZTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSk7XG4gICAgICB0ZXh0LmlucHV0RWwuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICB9KTsgXG59XG5cbmZ1bmN0aW9uIGFkZERyb3Bkb3duU2V0dGluZyhjb250YWluZXI6IEhUTUxFbGVtZW50LCBsYWJlbDogc3RyaW5nLCBzZXR0aW5nS2V5OiBzdHJpbmcgLCBvcHRpb25zOiBhbnkpIHtcbiAgY29uc3Qgc2V0dGluZ0NvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoKTtcbiAgc2V0dGluZ0NvbnRhaW5lci5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogbGFiZWwsIGNsczogXCJhYi1zZXR0aW5nLWl0ZW0tbmFtZVwiIH0pO1xuICBcbiAgbmV3IFNldHRpbmcoc2V0dGluZ0NvbnRhaW5lcilcbiAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4ge1xuICAgICAgZHJvcGRvd24uYWRkT3B0aW9ucyhvcHRpb25zKVxuICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Nbc2V0dGluZ0tleV0pXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcInZhbHVlXCIsIHZhbHVlKTtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KTtcbiAgICAgIGRyb3Bkb3duLnNlbGVjdEVsLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGFkZFRvZ2dsZVNldHRpbmcoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgbGFiZWw6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZywgc2V0dGluZ0tleTogc3RyaW5nLCB0b2dnbGVDYWxsYmFjazogYW55KSB7XG4gIGNvbnN0IHNldHRpbmdDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRGl2KCk7XG4gIFxuICBuZXcgU2V0dGluZyhzZXR0aW5nQ29udGFpbmVyKVxuICAgIC5zZXROYW1lKGxhYmVsKVxuICAgIC5zZXREZXNjKGRlc2NyaXB0aW9uKVxuICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHtcbiAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSlcbiAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgdG9nZ2xlQ2FsbGJhY2sodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gYWRkVGV4dEFyZWFTZXR0aW5nKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGxhYmVsOiBzdHJpbmcgLCBwbGFjZWhvbGRlcjogc3RyaW5nLCBzZXR0aW5nS2V5OiBzdHJpbmcpIHtcbiAgY29uc3Qgc2V0dGluZ0NvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoKTtcbiAgc2V0dGluZ0NvbnRhaW5lci5jcmVhdGVFbChcImxhYmVsXCIsIHsgdGV4dDogbGFiZWwsIGNsczogXCJhYi1zZXR0aW5nLWl0ZW0tbmFtZVwiIH0pO1xuICBcbiAgbmV3IFNldHRpbmcoc2V0dGluZ0NvbnRhaW5lcilcbiAgICAuYWRkVGV4dEFyZWEodGV4dEFyZWEgPT4ge1xuICAgICAgdGV4dEFyZWEuc2V0UGxhY2Vob2xkZXIocGxhY2Vob2xkZXIpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5nc1tzZXR0aW5nS2V5XSlcbiAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzW3NldHRpbmdLZXldID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KTtcbiAgICAgIHRleHRBcmVhLmlucHV0RWwuc3R5bGUuaGVpZ2h0ID0gXCIxNTBweFwiO1xuICAgICAgdGV4dEFyZWEuaW5wdXRFbC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIH0pO1xufVxuXG5cbmNsYXNzIEFCU1BsdWdpblNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBBQlNQbHVnaW47XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogUGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICB9XG5cbiAgZGlzcGxheSgpIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJBdWRpb2Jvb2tzaGVsZiBJbXBvcnRlciBTZXR0aW5nc1wiIH0pO1xuXG4gICAgYWRkVGV4dFNldHRpbmcuY2FsbCh0aGlzLCBjb250YWluZXJFbCwgXCJBQlMgSG9zdFwiLCBcIkVudGVyIHRoZSBiYXNlIFVSTCAod2l0aG91dCBcXFwiaHR0cHM6Ly9cXFwiKVwiLCBcImV4YW1wbGUuYWJzLm9yZ1wiLCBcImhvc3RcIik7XG4gICAgYWRkVGV4dFNldHRpbmcuY2FsbCh0aGlzLCBjb250YWluZXJFbCwgXCJBUEkgS2V5XCIsIFwiRW50ZXIgeW91ciBBUEkgS2V5XCIsIFwiPGFwaUtleT5cIiwgXCJhcGlLZXlcIik7XG5cbiAgICBhZGRUb2dnbGVTZXR0aW5nLmNhbGwodGhpcywgY29udGFpbmVyRWwsIFwiQXVkaW9ib29rc1wiLCBcIlRvZ2dsZSB0byBlbmFibGUgKyBzaG93IHNldHRpbmdzLlwiLCBcImFiRW5hYmxlXCIsICh2YWx1ZSkgPT4ge1xuICAgICAgYWJGaWVsZHNDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IHZhbHVlID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gICAgfSk7XG4gIFxuICAgIGNvbnN0IGFiV3JhcHBlciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogXCJzdGFja2VkLWlucHV0c1wiIH0pO1xuICAgIGNvbnN0IGFiRmllbGRzQ29udGFpbmVyID0gYWJXcmFwcGVyLmNyZWF0ZURpdih7IGNsczogXCJmaWVsZHMtY29udGFpbmVyXCIgfSk7XG5cbiAgICBhZGRUZXh0U2V0dGluZy5jYWxsKHRoaXMsIGFiRmllbGRzQ29udGFpbmVyLCBcIkxvY2FsIERpcmVjdG9yeTpcIiwgXCJcIiwgXCJBQlMvQXVkaW9ib29rc1wiLCBcImFiRGlyXCIpO1xuICAgIGFkZFRleHRTZXR0aW5nLmNhbGwodGhpcywgYWJGaWVsZHNDb250YWluZXIsIFwiTGlicmFyeSBJRDpcIiwgXCJcIiwgXCJhZHM3Nnlmc2Qtc2Q3NjctcDlhYS0zNGRzZC05ODlzOGRhc2RcIiwgXCJhYkxpYlwiKTtcbiAgICBhZGREcm9wZG93blNldHRpbmcuY2FsbCh0aGlzLCBhYkZpZWxkc0NvbnRhaW5lciwgXCJQYWdlIFNvcnQ6XCIsIFwiYWJTb3J0QnlcIiwge1xuICAgICAgW1wiYXV0aG9yTmFtZVwiXTogXCJBdXRob3IgTmFtZSB8IEZOLCBMTiAoQXNjKVwiLFxuICAgICAgW1wiYXV0aG9yTmFtZUxGXCJdOiBcIkF1dGhvciBOYW1lIHwgTE4sIEZOIChBc2MpXCJcbiAgICB9KTtcbiAgICBhZGRUZXh0QXJlYVNldHRpbmcuY2FsbCh0aGlzLCBhYkZpZWxkc0NvbnRhaW5lciwgXCJQYWdlIFRlbXBsYXRlOlwiLCBcIjwhLS0hPlwiLCBcImFiVGVtcGxhdGVcIik7XG4gICAgXG4gICAgYWJXcmFwcGVyLmFwcGVuZENoaWxkKGFiRmllbGRzQ29udGFpbmVyKTtcbiAgICBhYkZpZWxkc0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuYWJFbmFibGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcblxuICAgIGFkZFRvZ2dsZVNldHRpbmcuY2FsbCh0aGlzLCBjb250YWluZXJFbCwgXCJFYm9va3NcIiwgXCJUb2dnbGUgdG8gZW5hYmxlICsgc2hvdyBzZXR0aW5ncy5cIiwgXCJlYkVuYWJsZVwiLCAodmFsdWUpID0+IHtcbiAgICAgIGViRmllbGRzQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSB2YWx1ZSA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICAgIH0pO1xuXG4gICAgY29uc3QgZWJXcmFwcGVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KHsgY2xzOiBcInN0YWNrZWQtaW5wdXRzXCIgfSk7XG4gICAgY29uc3QgZWJGaWVsZHNDb250YWluZXIgPSBlYldyYXBwZXIuY3JlYXRlRGl2KHsgY2xzOiBcImZpZWxkcy1jb250YWluZXJcIiB9KTtcblxuICAgIGFkZFRleHRTZXR0aW5nLmNhbGwodGhpcywgZWJGaWVsZHNDb250YWluZXIsIFwiTG9jYWwgRGlyZWN0b3J5OlwiLCBcIlwiLCBcIkFCUy9FYm9va3NcIiwgXCJlYkRpclwiKTtcbiAgICBhZGRUZXh0U2V0dGluZy5jYWxsKHRoaXMsIGViRmllbGRzQ29udGFpbmVyLCBcIkxpYnJhcnkgSUQ6XCIsIFwiXCIsIFwiYWRzNzZ5ZnNkLXNkNzY3LXA5YWEtMzRkc2QtOTg5czhkYXNkXCIsIFwiZWJMaWJcIik7XG4gICAgYWRkRHJvcGRvd25TZXR0aW5nLmNhbGwodGhpcywgZWJGaWVsZHNDb250YWluZXIsIFwiUGFnZSBTb3J0OlwiLCBcImViU29ydEJ5XCIsIHtcbiAgICAgIFtcImF1dGhvck5hbWVcIl06IFwiQXV0aG9yIE5hbWUgfCBGTiwgTE4gKEFzYylcIixcbiAgICAgIFtcImF1dGhvck5hbWVMRlwiXTogXCJBdXRob3IgTmFtZSB8IExOLCBGTiAoQXNjKVwiXG4gICAgfSk7XG4gICAgYWRkVGV4dEFyZWFTZXR0aW5nLmNhbGwodGhpcywgZWJGaWVsZHNDb250YWluZXIsIFwiUGFnZSBUZW1wbGF0ZTpcIiwgXCI8IS0tIT5cIiwgXCJlYlRlbXBsYXRlXCIpO1xuXG4gICAgZWJXcmFwcGVyLmFwcGVuZENoaWxkKGViRmllbGRzQ29udGFpbmVyKTtcbiAgICBlYkZpZWxkc0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZWJFbmFibGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcblxuICAgIGFkZFRvZ2dsZVNldHRpbmcuY2FsbCh0aGlzLCBjb250YWluZXJFbCwgXCJQb2RjYXN0c1wiLCBcIlRvZ2dsZSB0byBlbmFibGUgKyBzaG93IHNldHRpbmdzLlwiLCBcInBvZEVuYWJsZVwiLCAodmFsdWUpID0+IHtcbiAgICAgIHBvZEZpZWxkc0NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gdmFsdWUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICB9KTtcblxuICAgIGNvbnN0IHBvZFdyYXBwZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6IFwic3RhY2tlZC1pbnB1dHNcIiB9KTtcbiAgICBjb25zdCBwb2RGaWVsZHNDb250YWluZXIgPSBwb2RXcmFwcGVyLmNyZWF0ZURpdih7IGNsczogXCJmaWVsZHMtY29udGFpbmVyXCIgfSk7XG5cbiAgICBhZGRUZXh0U2V0dGluZy5jYWxsKHRoaXMsIHBvZEZpZWxkc0NvbnRhaW5lciwgXCJMb2NhbCBEaXJlY3Rvcnk6XCIsIFwiXCIsIFwiQUJTL1BvZGNhc3RzXCIsIFwicG9kRGlyXCIpO1xuICAgIGFkZFRleHRTZXR0aW5nLmNhbGwodGhpcywgcG9kRmllbGRzQ29udGFpbmVyLCBcIkxpYnJhcnkgSUQ6XCIsIFwiXCIsIFwiYWRzNzZ5ZnNkLXNkNzY3LXA5YWEtMzRkc2QtOTg5czhkYXNkXCIsIFwicG9kTGliXCIpO1xuICAgIGFkZERyb3Bkb3duU2V0dGluZy5jYWxsKHRoaXMsIHBvZEZpZWxkc0NvbnRhaW5lciwgXCJQYWdlIFNvcnQ6XCIsIFwicG9kU29ydEJ5XCIsIHtcbiAgICAgIFtcImF1dGhvck5hbWVcIl06IFwiQXV0aG9yIE5hbWUgfCBGTiwgTE4gKEFzYylcIixcbiAgICAgIFtcImF1dGhvck5hbWVMRlwiXTogXCJBdXRob3IgTmFtZSB8IExOLCBGTiAoQXNjKVwiXG4gICAgfSk7XG4gICAgYWRkVGV4dEFyZWFTZXR0aW5nLmNhbGwodGhpcywgcG9kRmllbGRzQ29udGFpbmVyLCBcIlBhZ2UgVGVtcGxhdGU6XCIsIFwiPCEtLSE+XCIsIFwicG9kVGVtcGxhdGVcIik7XG5cbiAgICBwb2RXcmFwcGVyLmFwcGVuZENoaWxkKHBvZEZpZWxkc0NvbnRhaW5lcik7XG4gICAgcG9kRmllbGRzQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb2RFbmFibGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcblxuICB9XG59XG5cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQXlFO0FBeUJ6RSxJQUFNLG1CQUFzQztBQUFBLEVBQzFDLE1BQU07QUFBQSxFQUNOLFFBQVE7QUFBQSxFQUVSLE9BQU87QUFBQSxFQUNQLFVBQVU7QUFBQSxFQUNWLE9BQU87QUFBQSxFQUNQLFVBQVU7QUFBQSxFQUNWLFlBQVk7QUFBQSxFQUVaLE9BQU87QUFBQSxFQUNQLFVBQVU7QUFBQSxFQUNWLE9BQU87QUFBQSxFQUNQLFVBQVU7QUFBQSxFQUNWLFlBQVk7QUFBQSxFQUVaLFFBQVE7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
