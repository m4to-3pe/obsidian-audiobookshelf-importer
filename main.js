/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => ABSPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  host: "",
  library: "",
  token: "",
  folder: "",
  template: "",
  sortBy: ""
};
var ABSPlugin = class extends import_obsidian.Plugin {
  async loadSettings() {
    this.settings = Object.assign(
      {},
      DEFAULT_SETTINGS,
      await this.loadData()
    );
  }
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new ABSPluginSettingTab(this.app, this));
    const ribbonIconEl = this.addRibbonIcon("audio-file", "ABS", () => {
      new import_obsidian.Notice("Fetching audiobooks...");
      this.fetchAndCreateNotes();
    });
    this.addCommand({
      id: "fetch-books",
      name: "Fetch books and create notes",
      callback: async () => {
        await this.fetchAndCreateNotes();
      }
    });
  }
  async fetchAndCreateNotes() {
    if (!this.settings.host || !this.settings.library || !this.settings.token) {
      new import_obsidian.Notice("Please configure API settings in the ABS Plugin settings.");
      return;
    }
    if (!this.settings.folder) {
      new import_obsidian.Notice("Please configure destination folder in the ABS Plugin settings.");
      return;
    }
    const apiUrl = `https://${this.settings.host}/api/libraries/${this.settings.library}/items?sort=media.metadata.title`;
    try {
      const response = await (0, import_obsidian.request)({
        url: apiUrl,
        method: "GET",
        headers: {
          Authorization: `Bearer ${this.settings.token}`
        }
      });
      if (!response) {
        throw new Error(`Failed to fetch books: ${response}`);
      }
      const data = JSON.parse(response);
      const books = (data.results || []).map((book) => {
        var _a;
        return {
          id: book.id,
          relPath: book.relPath,
          metadata: ((_a = book.media) == null ? void 0 : _a.metadata) || {}
        };
      }).sort((a, b) => a.relPath.localeCompare(b.relPath));
      const folder = this.app.vault.getAbstractFileByPath(`${this.settings.folder}`);
      if (!folder) {
        await this.app.vault.createFolder(`${this.settings.folder}`);
      }
      let abData = {};
      const abJsonData = {};
      for (const book of books) {
        var metadata = book.metadata;
        abJsonData.metadata = metadata;
        abJsonData.authorName = metadata.authorName;
        abJsonData.authorNameLF = metadata.authorNameLF;
        abJsonData.coverURL = `https://${this.settings.host}/audiobookshelf/api/items/${book.id}/cover`;
        abJsonData.description = metadata.description;
        abJsonData.jsonData = JSON.stringify(book, null, 2);
        abJsonData.narrator = metadata.narrator;
        abJsonData.publishedDate = metadata.publishedDate;
        abJsonData.publishedYear = metadata.publishedYear;
        abJsonData.publisher = metadata.publisher;
        abJsonData.title = metadata.title;
        const sanitizedTitle = metadata.title.replace(/[\/:*?"<>|]/g, "");
        var filePath = "";
        var sortArtist = `${abJsonData.authorNameLF}`;
        if (`${this.settings.sortBy}` == "authorNameLF") {
          sortArtist = `${abJsonData.authorNameLF}`;
        } else if (`${this.settings.sortBy}` == "authorName") {
          sortArtist = `${abJsonData.authorName}`;
        }
        if (book.metadata.seriesName != "") {
          filePath = `${this.settings.folder}/${sortArtist}/${book.metadata.seriesName.replace(/\s+#\d+$/, "").trim()}/${sanitizedTitle}.md`;
        } else {
          filePath = `${this.settings.folder}/${sortArtist}/${sanitizedTitle}.md`;
        }
        console.log(filePath);
        if (!this.app.vault.getAbstractFileByPath(filePath)) {
          await this.ensureFolderExists(filePath);
          await this.app.vault.create(filePath, this.getBookTemplate(abJsonData));
        } else {
        }
      }
      new import_obsidian.Notice("Books fetched and notes created successfully!");
    } catch (error) {
      console.error("Error fetching books:", error, " from ", apiUrl);
      new import_obsidian.Notice("Failed to fetch books. Check the console for details.");
    }
  }
  async ensureFolderExists(filePath) {
    const folderPath = filePath.substring(0, filePath.lastIndexOf("/"));
    if (!folderPath) return;
    const folder = this.app.vault.getAbstractFileByPath(folderPath);
    if (!folder) {
      await this.app.vault.createFolder(folderPath);
      console.log(`Created folder: ${folderPath}`);
    }
  }
  getBookTemplate(abJsonData) {
    return `${this.settings.template}`.replace(/{{(.*?)}}/g, (_, key) => {
      return abJsonData[key.trim()] || "";
    });
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var ABSPluginSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "ABS Plugin Settings" });
    new import_obsidian.Setting(containerEl).setName("API Host").setDesc("Enter the base URL of the API (without https://)").addText(
      (text) => text.setPlaceholder("example.abs.org").setValue(this.plugin.settings.host).onChange(async (value) => {
        this.plugin.settings.host = value.trim();
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("Library").setDesc("Enter the library ID or name").addText(
      (text) => text.setPlaceholder("audiobooks").setValue(this.plugin.settings.library).onChange(async (value) => {
        this.plugin.settings.library = value.trim();
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("API Token").setDesc("Enter your API token").addText(
      (text) => text.setPlaceholder("your-token-here").setValue(this.plugin.settings.token).onChange(async (value) => {
        this.plugin.settings.token = value.trim();
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("Folder").setDesc("Where to create pages.").addText(
      (text) => text.setPlaceholder("ABS").setValue(this.plugin.settings.folder).onChange(async (value) => {
        this.plugin.settings.folder = value.trim();
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("PAge Author Sort").setDesc("Sort new Pages. Default: By Author Name | LN, FN").addDropdown((dropdown) => {
      const options = {
        [
          "authorNameLF"
          /* authorNameLF */
        ]: "Author Name | LN, FN (Asc)",
        [
          "authorName"
          /* authorName */
        ]: "Author Name | FN, LN (Asc)"
      };
      dropdown.addOptions(options).setValue(this.plugin.settings.sortBy).onChange(
        async (value) => {
          console.log("value", value);
          this.plugin.settings.sortBy = value;
          await this.plugin.saveSettings();
        }
      );
    });
    new import_obsidian.Setting(containerEl).setName("Template").setDesc("Template for new pages.").addTextArea(
      (text) => text.setPlaceholder("<!--!>").setValue(this.plugin.settings.template).onChange(async (value) => {
        this.plugin.settings.template = value.trim();
        await this.plugin.saveSettings();
      })
    );
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgIHJlcXVlc3QsIE5vdGljZSwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmludGVyZmFjZSBBQlNQbHVnaW5TZXR0aW5ncyB7XG4gIGhvc3Q6IHN0cmluZztcbiAgbGlicmFyeTogc3RyaW5nO1xuICB0b2tlbjogc3RyaW5nO1xuICBmb2xkZXI6IHN0cmluZztcbiAgdGVtcGxhdGU6IHN0cmluZztcbiAgc29ydEJ5OiBzdHJpbmdcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQUJTUGx1Z2luU2V0dGluZ3MgPSB7XG4gIGhvc3Q6IFwiXCIsXG4gIGxpYnJhcnk6IFwiXCIsXG4gIHRva2VuOiBcIlwiLFxuICBmb2xkZXI6IFwiXCIsXG4gIHRlbXBsYXRlOiBcIlwiLFxuICBzb3J0Qnk6IFwiXCIsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBQlNQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogQUJTUGx1Z2luU2V0dGluZ3M7XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKFxuICAgICAge30sIFxuICAgICAgREVGQVVMVF9TRVRUSU5HUywgXG4gICAgICBhd2FpdCB0aGlzLmxvYWREYXRhKClcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cbiAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IEFCU1BsdWdpblNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuICAgIGNvbnN0IHJpYmJvbkljb25FbCA9IHRoaXMuYWRkUmliYm9uSWNvbihcImF1ZGlvLWZpbGVcIiwgXCJBQlNcIiwgKCkgPT4ge1xuICAgICAgbmV3IE5vdGljZShcIkZldGNoaW5nIGF1ZGlvYm9va3MuLi5cIik7XG4gICAgICB0aGlzLmZldGNoQW5kQ3JlYXRlTm90ZXMoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJmZXRjaC1ib29rc1wiLFxuICAgICAgbmFtZTogXCJGZXRjaCBib29rcyBhbmQgY3JlYXRlIG5vdGVzXCIsXG4gICAgICBjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCB0aGlzLmZldGNoQW5kQ3JlYXRlTm90ZXMoKTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBmZXRjaEFuZENyZWF0ZU5vdGVzKCkge1xuICAgIGlmICghdGhpcy5zZXR0aW5ncy5ob3N0IHx8ICF0aGlzLnNldHRpbmdzLmxpYnJhcnkgfHwgIXRoaXMuc2V0dGluZ3MudG9rZW4pIHtcbiAgICAgIG5ldyBOb3RpY2UoXCJQbGVhc2UgY29uZmlndXJlIEFQSSBzZXR0aW5ncyBpbiB0aGUgQUJTIFBsdWdpbiBzZXR0aW5ncy5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdGhpcy5zZXR0aW5ncy5mb2xkZXIpIHtcbiAgICAgIG5ldyBOb3RpY2UoXCJQbGVhc2UgY29uZmlndXJlIGRlc3RpbmF0aW9uIGZvbGRlciBpbiB0aGUgQUJTIFBsdWdpbiBzZXR0aW5ncy5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgYXBpVXJsID0gYGh0dHBzOi8vJHt0aGlzLnNldHRpbmdzLmhvc3R9L2FwaS9saWJyYXJpZXMvJHt0aGlzLnNldHRpbmdzLmxpYnJhcnl9L2l0ZW1zP3NvcnQ9bWVkaWEubWV0YWRhdGEudGl0bGVgO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7XG4gICAgICAgIHVybDogYXBpVXJsLFxuICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5zZXR0aW5ncy50b2tlbn1gLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gIFxuXG4gICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGJvb2tzOiAke3Jlc3BvbnNlfWApO1xuICAgICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgIFxuICAgIGNvbnN0IGJvb2tzID0gKGRhdGEucmVzdWx0cyB8fCBbXSlcbiAgICAgIC5tYXAoKGJvb2s6IGFueSkgPT4gKHtcbiAgICAgICAgaWQ6IGJvb2suaWQsXG4gICAgICAgIHJlbFBhdGg6IGJvb2sucmVsUGF0aCxcbiAgICAgICAgbWV0YWRhdGE6IGJvb2subWVkaWE/Lm1ldGFkYXRhIHx8IHt9LCBcbiAgICAgIH0pKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGEucmVsUGF0aC5sb2NhbGVDb21wYXJlKGIucmVsUGF0aCkpOyBcblxuICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChgJHt0aGlzLnNldHRpbmdzLmZvbGRlcn1gKTtcbiAgICBpZiAoIWZvbGRlcikge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKGAke3RoaXMuc2V0dGluZ3MuZm9sZGVyfWApO1xuICAgIH1cblxuICAgIGxldCBhYkRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbiAgICBjb25zdCBhYkpzb25EYXRhIDogYW55ID0ge307XG4gICAgZm9yIChjb25zdCBib29rIG9mIGJvb2tzKSB7XG4gICAgICB2YXIgbWV0YWRhdGEgPSBib29rLm1ldGFkYXRhO1xuICAgICAgYWJKc29uRGF0YS5tZXRhZGF0YSA9IG1ldGFkYXRhO1xuICAgICAgYWJKc29uRGF0YS5hdXRob3JOYW1lID0gbWV0YWRhdGEuYXV0aG9yTmFtZTtcbiAgICAgIGFiSnNvbkRhdGEuYXV0aG9yTmFtZUxGID0gbWV0YWRhdGEuYXV0aG9yTmFtZUxGO1xuICAgICAgYWJKc29uRGF0YS5jb3ZlclVSTCA9IGBodHRwczovLyR7dGhpcy5zZXR0aW5ncy5ob3N0fS9hdWRpb2Jvb2tzaGVsZi9hcGkvaXRlbXMvJHtib29rLmlkfS9jb3ZlcmA7XG4gICAgICBhYkpzb25EYXRhLmRlc2NyaXB0aW9uID0gbWV0YWRhdGEuZGVzY3JpcHRpb247XG4gICAgICBhYkpzb25EYXRhLmpzb25EYXRhID0gSlNPTi5zdHJpbmdpZnkoYm9vaywgbnVsbCwgMik7XG4gICAgICBhYkpzb25EYXRhLm5hcnJhdG9yID0gbWV0YWRhdGEubmFycmF0b3I7XG4gICAgICBhYkpzb25EYXRhLnB1Ymxpc2hlZERhdGUgPSBtZXRhZGF0YS5wdWJsaXNoZWREYXRlO1xuICAgICAgYWJKc29uRGF0YS5wdWJsaXNoZWRZZWFyID0gbWV0YWRhdGEucHVibGlzaGVkWWVhcjtcbiAgICAgIGFiSnNvbkRhdGEucHVibGlzaGVyID0gbWV0YWRhdGEucHVibGlzaGVyO1xuICAgICAgYWJKc29uRGF0YS50aXRsZSA9IG1ldGFkYXRhLnRpdGxlO1xuXG4gICAgICBjb25zdCBzYW5pdGl6ZWRUaXRsZSA9IG1ldGFkYXRhLnRpdGxlLnJlcGxhY2UoL1tcXC86Kj9cIjw+fF0vZywgXCJcIik7XG4gICAgICB2YXIgZmlsZVBhdGggPSBcIlwiXG5cbiAgICAgIHZhciBzb3J0QXJ0aXN0ID0gYCR7YWJKc29uRGF0YS5hdXRob3JOYW1lTEZ9YFxuICAgICAgaWYgKGAke3RoaXMuc2V0dGluZ3Muc29ydEJ5fWAgPT0gXCJhdXRob3JOYW1lTEZcIikge1xuICAgICAgICBzb3J0QXJ0aXN0ID0gYCR7YWJKc29uRGF0YS5hdXRob3JOYW1lTEZ9YFxuICAgICAgfWVsc2UgaWYgKGAke3RoaXMuc2V0dGluZ3Muc29ydEJ5fWAgPT0gXCJhdXRob3JOYW1lXCIpIHtcbiAgICAgICAgc29ydEFydGlzdCA9IGAke2FiSnNvbkRhdGEuYXV0aG9yTmFtZX1gXG4gICAgICB9XG5cbiAgICAgIGlmIChib29rLm1ldGFkYXRhLnNlcmllc05hbWUgIT0gXCJcIikge1xuICAgICAgICBmaWxlUGF0aCA9IGAke3RoaXMuc2V0dGluZ3MuZm9sZGVyfS8ke3NvcnRBcnRpc3R9LyR7Ym9vay5tZXRhZGF0YS5zZXJpZXNOYW1lLnJlcGxhY2UoL1xccysjXFxkKyQvLCBcIlwiKS50cmltKCl9LyR7c2FuaXRpemVkVGl0bGV9Lm1kYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpbGVQYXRoID0gYCR7dGhpcy5zZXR0aW5ncy5mb2xkZXJ9LyR7c29ydEFydGlzdH0vJHtzYW5pdGl6ZWRUaXRsZX0ubWRgO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coZmlsZVBhdGgpXG4gICAgICBpZiAoIXRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVGb2xkZXJFeGlzdHMoZmlsZVBhdGgpO1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIHRoaXMuZ2V0Qm9va1RlbXBsYXRlKGFiSnNvbkRhdGEpKVxuICAgICAgICAvLyBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KGJvb2ssIG51bGwsIDIpKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYENyZWF0ZWQ6ICR7ZmlsZVBhdGh9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhgU2tpcHBlZDogJHtmaWxlUGF0aH0gKEFscmVhZHkgZXhpc3RzKWApO1xuICAgICAgfVxuICAgIH1cbiAgICAgIG5ldyBOb3RpY2UoXCJCb29rcyBmZXRjaGVkIGFuZCBub3RlcyBjcmVhdGVkIHN1Y2Nlc3NmdWxseSFcIik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBib29rczpcIiwgZXJyb3IsIFwiIGZyb20gXCIsIGFwaVVybCk7XG4gICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIGZldGNoIGJvb2tzLiBDaGVjayB0aGUgY29uc29sZSBmb3IgZGV0YWlscy5cIik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZW5zdXJlRm9sZGVyRXhpc3RzKGZpbGVQYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBmb2xkZXJQYXRoID0gZmlsZVBhdGguc3Vic3RyaW5nKDAsIGZpbGVQYXRoLmxhc3RJbmRleE9mKFwiL1wiKSk7XG4gIFxuICAgIGlmICghZm9sZGVyUGF0aCkgcmV0dXJuO1xuICBcbiAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZm9sZGVyUGF0aCk7XG4gICAgaWYgKCFmb2xkZXIpIHtcbiAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihmb2xkZXJQYXRoKTtcbiAgICAgIGNvbnNvbGUubG9nKGBDcmVhdGVkIGZvbGRlcjogJHtmb2xkZXJQYXRofWApO1xuICAgIH1cbiAgfVxuXG4gIGdldEJvb2tUZW1wbGF0ZShhYkpzb25EYXRhKSB7XG4gICAgcmV0dXJuIGAke3RoaXMuc2V0dGluZ3MudGVtcGxhdGV9YFxuICAgICAgLnJlcGxhY2UoL3t7KC4qPyl9fS9nLCAoXywga2V5KSA9PiB7XG4gICAgICAgIHJldHVybiBhYkpzb25EYXRhW2tleS50cmltKCldIHx8IFwiXCI7XG4gICAgICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gIH1cbn1cblxuY2xhc3MgQUJTUGx1Z2luU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IEFCU1BsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihhcHAsIHBsdWdpbikge1xuICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgfVxuXG4gIGRpc3BsYXkoKSB7XG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiQUJTIFBsdWdpbiBTZXR0aW5nc1wiIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkFQSSBIb3N0XCIpXG4gICAgICAuc2V0RGVzYyhcIkVudGVyIHRoZSBiYXNlIFVSTCBvZiB0aGUgQVBJICh3aXRob3V0IGh0dHBzOi8vKVwiKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJleGFtcGxlLmFicy5vcmdcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaG9zdClcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ob3N0ID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiTGlicmFyeVwiKVxuICAgICAgLnNldERlc2MoXCJFbnRlciB0aGUgbGlicmFyeSBJRCBvciBuYW1lXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcImF1ZGlvYm9va3NcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubGlicmFyeSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saWJyYXJ5ID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQVBJIFRva2VuXCIpXG4gICAgICAuc2V0RGVzYyhcIkVudGVyIHlvdXIgQVBJIHRva2VuXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcInlvdXItdG9rZW4taGVyZVwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50b2tlbilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50b2tlbiA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkZvbGRlclwiKVxuICAgICAgLnNldERlc2MoXCJXaGVyZSB0byBjcmVhdGUgcGFnZXMuXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIkFCU1wiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5mb2xkZXIpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZm9sZGVyID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUEFnZSBBdXRob3IgU29ydFwiKVxuICAgICAgLnNldERlc2MoXCJTb3J0IG5ldyBQYWdlcy4gRGVmYXVsdDogQnkgQXV0aG9yIE5hbWUgfCBMTiwgRk5cIilcbiAgICAgIC5hZGREcm9wZG93bigoZHJvcGRvd24pID0+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICBbXCJhdXRob3JOYW1lTEZcIiAvKiBhdXRob3JOYW1lTEYgKi9dOiBcIkF1dGhvciBOYW1lIHwgTE4sIEZOIChBc2MpXCIsXG4gICAgICAgICAgW1wiYXV0aG9yTmFtZVwiIC8qIGF1dGhvck5hbWUgKi9dOiBcIkF1dGhvciBOYW1lIHwgRk4sIExOIChBc2MpXCJcbiAgICAgICAgfTtcbiAgICAgICAgZHJvcGRvd25cbiAgICAgICAgLmFkZE9wdGlvbnMob3B0aW9ucylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc29ydEJ5KVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidmFsdWVcIiwgdmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc29ydEJ5ID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJUZW1wbGF0ZVwiKVxuICAgICAgLnNldERlc2MoXCJUZW1wbGF0ZSBmb3IgbmV3IHBhZ2VzLlwiKVxuICAgICAgLmFkZFRleHRBcmVhKCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiPCEtLSE+XCIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cbn1cblxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBb0U7QUFXcEUsSUFBTSxtQkFBc0M7QUFBQSxFQUMxQyxNQUFNO0FBQUEsRUFDTixTQUFTO0FBQUEsRUFDVCxPQUFPO0FBQUEsRUFDUCxRQUFRO0FBQUEsRUFDUixVQUFVO0FBQUEsRUFDVixRQUFRO0FBQ1Y7QUFFQSxJQUFxQixZQUFyQixjQUF1Qyx1QkFBTztBQUFBLEVBRzVDLE1BQU0sZUFBZTtBQUNuQixTQUFLLFdBQVcsT0FBTztBQUFBLE1BQ3JCLENBQUM7QUFBQSxNQUNEO0FBQUEsTUFDQSxNQUFNLEtBQUssU0FBUztBQUFBLElBQ3RCO0FBQUEsRUFDRjtBQUFBLEVBRUEsTUFBTSxTQUFTO0FBQ2IsVUFBTSxLQUFLLGFBQWE7QUFFeEIsU0FBSyxjQUFjLElBQUksb0JBQW9CLEtBQUssS0FBSyxJQUFJLENBQUM7QUFFMUQsVUFBTSxlQUFlLEtBQUssY0FBYyxjQUFjLE9BQU8sTUFBTTtBQUNqRSxVQUFJLHVCQUFPLHdCQUF3QjtBQUNuQyxXQUFLLG9CQUFvQjtBQUFBLElBQzNCLENBQUM7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNkLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsWUFBWTtBQUNwQixjQUFNLEtBQUssb0JBQW9CO0FBQUEsTUFDakM7QUFBQSxJQUNGLENBQUM7QUFBQSxFQUNIO0FBQUEsRUFFQSxNQUFN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
